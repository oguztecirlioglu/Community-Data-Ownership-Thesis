<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: virtualDevice.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: virtualDevice.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const axios = require("axios");
const express = require("express");
const utils = require("./utils");

/** @global */
const apiEndpoint = utils.envOrDefault("VIRTUAL_DEVICE_API_ENDPOINT", "/api/post");

/** @global */
const intervalSeconds = utils.envOrDefault("VIRTUAL_DEVICE_INTERVAL_SECONDS", 10);

/** @global */
const port = utils.envOrDefault("VIRTUAL_DEVICE_PORT", 3000);

/** @global */
const randomnessAmount = utils.envOrDefault("VIRTUAL_DEVICE_RANDOMNESS_AMOUNT", 0);

let lastJSONArray = [];

const app = express();
app.use(express.json());

/**
 * Async method that sends randomly generated data to the API endpoint which was configured by reading environment variables.
 */
async function sendData() {
  const data = utils.generateRandomData(randomnessAmount);

  try {
    await axios.post(apiEndpoint, data, {
      baseURL: `http://localhost:${port}`,
    });
    console.log("Data sent:", data);
  } catch (error) {
    console.error("Error sending data:", error);
  }
}

// Created for testing purposes, the virtual device makes a http post request to itself
// which gets appended to an array.
app.post(apiEndpoint, (req, res) => {
  lastJSONArray.push(req.body);
  res.status(200).send("Data recieved succesfully");
});

app.get("/api/allData", (req, res) => {
  res.send(lastJSONArray);
});

app.listen(port, () => {
  console.log(`Server running on port ${port}`);
});

setInterval(sendData, intervalSeconds * 250);

if (require.main === module) {
  console.log(main);
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#apiEndpoint">apiEndpoint</a></li><li><a href="global.html#generateRandomData">generateRandomData</a></li><li><a href="global.html#intervalSeconds">intervalSeconds</a></li><li><a href="global.html#port">port</a></li><li><a href="global.html#randomnessAmount">randomnessAmount</a></li><li><a href="global.html#sendData">sendData</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Jul 19 2023 16:00:21 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
